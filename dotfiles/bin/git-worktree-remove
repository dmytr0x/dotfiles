#!/usr/bin/env bash

# You can use it as a git alias in .gitconfig, e.g.:
# [alias]
#   wt-rm = !git-worktree-remove ../.worktrees/$(basename "$PWD")
#

set -e
set -u
set -o pipefail

if [ "$#" -ne 1 ]; then
  echo "Remove a Git worktree."
  echo "Usage: $(basename $0) <path>"
  echo "  <path>: The git worktree directory."
  exit 1
fi

WORKTREE_PATH=$1

worktree=$(ls -1 "$WORKTREE_PATH" | fzf \
  --prompt="Select worktree to remove: " \
  --height=60% \
  --border \
  --no-preview)

if [ -n "$worktree" ]; then
  read -p "Are you sure you want to remove worktree '$worktree'? [y/N]" -n 1 -r
  if [[ $REPLY =~ ^[Yy]$ ]]; then
    git worktree remove --force "$WORKTREE_PATH/$worktree"
    git branch --delete --force '$worktree'
    echo
    echo "Worktree '$worktree' deleted."
  fi
fi

exit 0
